SELECT w.id, wp.age, w.coins_needed, w.power from wands w inner join wands_property wp on w.code=wp.code where wp.is_evil = 0 and w.coins_needed = (select min(wtemp.coins_needed) from wands wtemp inner join wands_property wptemp on wtemp.code=wptemp.code where wp.age = wptemp.age and w.power= wtemp.power )order by  w.power desc, wp.age desc;